<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>库存记录小程序</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
input, button { margin:5px; padding:5px; }
#suggestions { border:1px solid #ccc; max-height:150px; overflow-y:auto; position:absolute; background:#fff; width:200px; }
#suggestions li { padding:5px; cursor:pointer; }
#suggestions li:hover { background:#eee; }
.product-name { font-weight:bold; color:green; margin-left:10px; }
table { border-collapse: collapse; margin-top:20px; width:100%; }
th,td { border:1px solid #ccc; padding:8px; text-align:center; }
.actions button { margin:0 3px; }
</style>
<script>
if('serviceWorker' in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('service-worker.js');});}
</script>
</head>
<body>
<h2>库存记录小程序</h2>

<label>产品代号:</label>
<input id="code" autocomplete="off" style="width:200px;" oninput="showSuggestions()">
<span id="productName" class="product-name"></span>
<ul id="suggestions" style="display:none"></ul>
<br>

<label>数量:</label>
<input id="qty" placeholder="可输入公式 12*5">
<br>
<label>备注:</label>
<input id="remark">
<br>
<button onclick="addRecord()">提交</button>
<button onclick="viewRecords()">查看记录</button>
<button onclick="exportExcel()">导出Excel</button>

<table id="recordTable" style="display:none">
<thead>
<tr>
<th>产品代号</th><th>产品名称</th><th>数量</th><th>备注</th><th>操作</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// 产品目录
const productCatalog = {
"I10000":"Bakeable Caramel Filling",
"I10005":"BFP 65K",
"I10006":"80% Unsalted Butter",
"I10009":"Ice",
"I10010":"Neuf Cheese Blend",
"I10011":"73157 700170 Cheese Filling Preblend Topping (BIMBO)",
"I10012":"73159 700434 Raspberry Twist Filling Preblend",
"I10013":"73324 700168 Cheese Twist Filling Preblend",
"I10020":"Emplex (101009)",
"I10024":"Softase 1700",
"I10027":"Lemon Juice",
"I10028":"Juice Orange Concentrate 50359",
"I10058":"Rspb Bimbo Filling (for A)",
"I10059":"Rspb Bimbo Filling - NO HFCS (BIMBO 2024)",
"I10060":"Bagged Flour",
"I10061":"Whole Wheat (103904)",
"I10062":"Patent Flour",
"I10063":"Baker's Soy Flour (105808)",
"I10064":"Oat Fiber",
"I10065":"Pastry Flour",
"I10066":"73152 700165 Danish Twist Dough Preblend",
"I10067":"73311 700167 Dough Gum Preblend",
"I10068":"Soy Fiber",
"I10069":"Methyl Cellulose",
"I10073":"Cinnamon (103310)",
"I10074":"Salt (102960)",
"I10075":"Btr Flvr Powdered",
"I10076":"50161 118D1281 Art Vanilla Flvr",
"I10078":"209-0962 Art Btr Flvr",
"I10079":"118D1242 Flavor White Lemon Emulsion 50163 (BIMBO)",
"I10080":"Yogurt Flavor",
"I10082":"WS 200-1402 Butter&Vanilla Flvr",
"I10083":"Natural Vanilla Flavor WONF WS",
"I10125":"Sans Trans 50 MB",
"I10131":"Bunge 528 Cool",
"I10133":"M173 Lamination Fat (BIMBO)- MB",
"I10136":"Non Fat Dry Milk(100805)",
"I10138":"Whey - Sweet Dairy (100792)",
"I10139":"Whole Powder Milk",
"I10148":"Mineral Oil",
"I10149":"Crumbled Yeast",
"I10150":"029612 Mono & Diglyceride 50% BFP 550",
"I10151":"Calcium Proprionate (102840)",
"I10152":"Vital Wheat Gluten(103808)",
"I10158":"Ascorbic Powder",
"I10161":"Liquid Whole Eggs",
"I10166":"Tro-Lube Plus Low Viscosity",
"I10170":"N-Dulge CA (103193)",
"I10174":"Cane Juice Molasses (102198)",
"I10179":"Potassium Sorbate (101130)",
"I10181":"GPC Pure Cote B-792 (101956)",
"I10182":"Star-Dri 5 (100517)",
"I10183":"118L1220 50167 Flavor, Butter & Vanilla Emulsn, Artificial, Pail (BIMBO)",
"I10184":"Xanthum Gum",
"I10185":"118F1212 50169 Flavor Butter Artificial (BIMBO)",
"I10186":"118F1253 50164 Flavor Orange Emulsion",
"I10187":"Sta-Lite 987 (101027)",
"I10188":"Titatium Dioxide",
"I10189":"Citric Acid (100014)",
"I10190":"Baking Powder (101761)",
"I10191":"Phosphoric Acid Solution",
"I10193":"Clear Jel Starch (102005)",
"I10194":"Yeast Foods",
"I10201":"Tapioca Dextrin (102132)",
"I10233":"Hydrated plum, soy shortening",
"I10234":"Shortening",
"I10240":"Granulated Sugar - 2,000 lb totes",
"I10241":"HFCS",
"I10242":"42 DE Corn Syrup(106809)",
"I10243":"Soybean Oil",
"I10244":"Celerose Dextrose (100493)",
"I10245":"Sugar 10x w/3%Starch (103394)",
"I10246":"Brown Sugar",
"I10284":"Raspberry Filling HFCS-Free",
"I10295":"84358 Fat, Shortening, Palm Oil 39, Carton",
"I10306":"Alpha Fresh",
"I10307":"50387 Seeds, Coconut, Medium, Desiccated, Bag/Box",
"I10308":"Preservative, Vanagel Drum 53285",
"I10310":"Butter Complete / Natural Butter Type Flavor",
"I10314":"Frozen Egg Whites",
"I10315":"TRU CLF",
"I10316":"211 TRU CL",
"I10317":"Chisweet 50 Cane (101857)",
"I10318":"Michigan Cherry filling (4017301)",
"I10319":"Lemon - Deli Citron Filling (4107189)",
"I10320":"Natural Blueberry Tart Filling w Preservatives",
"I10322":"Diced Apple Turnover Filling",
"I10324":"Vivafil Raspberry Filling (4010155)",
"I10325":"Vivafil Strawberry Filling (4017051)",
"I10326":"Tomato Seasoning TOMP506 37S00014",
"I10327":"Basil Seasoning BS9205 RMS30",
"I10328":"Garlic & Parmesan Seasoning 68394A2 RMS28",
"I10329":"Jalepeno Seasoning JP9274 37S00012",
"I10330":"Cheddar Cheese Seasoning 65774A1 RMS29",
"I10331":"Cheesecake Seasoning (Elite Spice)",
"I10332":"Pumpkin Filling",
"I10335":"Puratop Cream Cheese Icing 4107586",
"I10336":"Puratos Cremfil Ultim Dark Chocolate",
"I10337":"Trem 21PF",
"I10338":"Puratop Belgian choco Fudge Base Plant-base",
"I10339":"Bavarian Creme",
"I10350":"WF Spice 4261",
"I10351":"J&K STA Icing",
"I10360":"Purac Powder 60",
"I10361":"Tandem 530",
"I10905":"Guar Gum (101689)",
"I11002":"Cinnamon Oil",
"I11005":"AlphaSoft A11",
"I11006":"Sea Salt, Coarse",
"I11021":"Accolade 105784 Puff Pastry Margarine MB",
"I11022":"Accolade 105785 Puff Pastry Margarine MB",
"I11024":"Cream Cheese",
"I11025":"335 MDR Soft",
"I11026":"Suncol-205",
"I11028":"All purpose shortening",
"I11029":"Gourmet Select Seedless Raspberry – FFI # 50827",
"I11030":"Perfectly Natural Cubed Apple – FFI # 2104",
"I11031":"Accolade 105788 Puff Pastry Margarine MB NO SALT",
"I11032":"Sweet Dough Flavor"
};

let records=[];

// 模糊搜索
function showSuggestions(){
  const input=document.getElementById("code").value.trim().toLowerCase();
  const suggestions=document.getElementById("suggestions");
  suggestions.innerHTML="";
  if(!input){suggestions.style.display="none";return;}
  const matches=Object.entries(productCatalog).filter(([code,name])=>{
    return code.toLowerCase().includes(input)||name.toLowerCase().includes(input);
  }).slice(0,20); // 最多20条
  matches.forEach(([code,name])=>{
    const li=document.createElement("li");
    li.textContent=`${code} - ${name}`;
    li.onclick=()=>{document.getElementById("code").value=code; document.getElementById("productName").innerText=name; suggestions.style.display="none";}
    suggestions.appendChild(li);
  });
  suggestions.style.display=matches.length? "block":"none";
}

function evalQty(expr){try{return Function('"use strict";return ('+expr+')')();}catch(e){return NaN;}}

function addRecord(){
  const code=document.getElementById("code").value.trim();
  const qtyExpr=document.getElementById("qty").value.trim();
  const remark=document.getElementById("remark").value.trim();
  const qty=evalQty(qtyExpr);
  if(!code||isNaN(qty)){alert("请输入有效的代号和数量"); return;}
  records.push({code,name:productCatalog[code]||"",qty,remark});
  document.getElementById("code").value="";
  document.getElementById("qty").value="";
  document.getElementById("remark").value="";
  document.getElementById("productName").innerText="";
  renderTable();
}

function renderTable(){
  const table=document.getElementById("recordTable");
  const tbody=table.querySelector("tbody");
  tbody.innerHTML="";
  records.forEach((rec,i)=>{
    const row=document.createElement("tr");
    row.innerHTML=`<td>${rec.code}</td><td>${rec.name}</td><td>${rec.qty}</td><td>${rec.remark}</td><td class="actions"><button onclick="editRecord(${i})">编辑</button><button onclick="deleteRecord(${i})">删除</button></td>`;
    tbody.appendChild(row);
  });
  table.style.display=records.length?"table":"none";
}

function editRecord(i){
  const rec=records[i];
  const newCode=prompt("修改产品代号:",rec.code)||rec.code;
  const newQty=prompt("修改数量:",rec.qty)||rec.qty;
  const newRemark=prompt("修改备注:",rec.remark)||rec.remark;
  records[i]={code:newCode,name:productCatalog[newCode]||"",qty:evalQty(newQty),remark:newRemark};
  renderTable();
}

function deleteRecord(i){if(confirm("确认删除这条记录?")){records.splice(i,1);renderTable();}}

function viewRecords(){renderTable();}

function exportExcel(){
  if(!records.length){alert("没有记录可导出"); return;}
  const ws=XLSX.utils.json_to_sheet(records);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"库存记录");
  XLSX.writeFile(wb,"库存记录.xlsx");
}
</script>
</body>
</html>
